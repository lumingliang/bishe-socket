var Port = require('../lib/port');

var p = new Port({
	name : 'demo',
	environment : 'demo',
	maxMemory : 2222222,
	multiTenant : true,
	docker : {
		//"host" : "127.0.0.1",
		//"port" : 5000
		"socket" : '/var/run/docker.sock'
	}
});

p.run();

var redis = {
	"logs" : {
		"web" : {
			"port" : 80,
			"host" : "..."
		},
		"udp" : {
			"port" : 5000,
			"host" : "..."
		},
		"view" : {
			"port" : 80,
			"host" : "..."
		}
	},
	"logSession" : "docker.test",
	"name" : "docker.test",
	//"user" : "test",
	"index" : 1,
	"uid" : "uid",
	"source" : "app",
	"channel" : "redis.1",
	"process" : "web",
	"volumes" : {},
	"env" : {
		"hello" : "world",
		"PORT" : 8080
	},
	"limits" : {
		"memory" : 128,
		"cpuShares" : 256,
		"cpuset" : "0,1"
	},
	"image" : "redis",
	"ports" : ["8080/tcp"]
};
p.start(redis, function(err, container) {
	if (err) {
		return console.log(err)
		throw err;
	}
	console.log(container.info);
});
p.on('error', function(err) {
	console.log(err);
	//throw err;
});

process.on('SIGINT', function() {

	p.destroy(function(data) {
		console.log('destroyed', data);
		process.exit(1);
	});
});
